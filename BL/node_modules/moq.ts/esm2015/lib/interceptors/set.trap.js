import { SetPropertyExpression } from "../reflector/expressions";
import { MoqAPI } from "../moq";
/**
 * @hidden
 */
export class SetTrap {
    constructor(tracker, propertiesValueStorage, interactionPlayer, propertyIsReadOnlyTester) {
        this.tracker = tracker;
        this.propertiesValueStorage = propertiesValueStorage;
        this.interactionPlayer = interactionPlayer;
        this.propertyIsReadOnlyTester = propertyIsReadOnlyTester;
    }
    intercept(target, property, value) {
        const expression = new SetPropertyExpression(property, value);
        this.tracker.add(expression);
        if (property === MoqAPI) {
            return false;
        }
        if (this.propertyIsReadOnlyTester.isReadOnly(property) === true) {
            return false;
        }
        const accepted = this.interactionPlayer.play(expression);
        if (accepted === true || accepted === undefined) {
            this.propertiesValueStorage.set(property, value);
        }
        return accepted === undefined ? true : accepted;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0LnRyYXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9tb3Evc3JjL2xpYi9pbnRlcmNlcHRvcnMvc2V0LnRyYXAudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQ0EsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFHakUsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLFFBQVEsQ0FBQztBQUdoQzs7R0FFRztBQUNILE1BQU0sT0FBTyxPQUFPO0lBQ2hCLFlBQ1ksT0FBZ0IsRUFDaEIsc0JBQThDLEVBQzlDLGlCQUFvQyxFQUNwQyx3QkFBa0Q7UUFIbEQsWUFBTyxHQUFQLE9BQU8sQ0FBUztRQUNoQiwyQkFBc0IsR0FBdEIsc0JBQXNCLENBQXdCO1FBQzlDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtJQUU5RCxDQUFDO0lBRU0sU0FBUyxDQUFDLE1BQVcsRUFBRSxRQUFxQixFQUFFLEtBQVU7UUFDM0QsTUFBTSxVQUFVLEdBQUcsSUFBSSxxQkFBcUIsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFFOUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFN0IsSUFBSSxRQUFRLEtBQUssTUFBTSxFQUFFO1lBQ3JCLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO1FBRUQsSUFBSSxJQUFJLENBQUMsd0JBQXdCLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxLQUFLLElBQUksRUFBRTtZQUM3RCxPQUFPLEtBQUssQ0FBQztTQUNoQjtRQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekQsSUFBSSxRQUFRLEtBQUssSUFBSSxJQUFJLFFBQVEsS0FBSyxTQUFTLEVBQUU7WUFDN0MsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDcEQ7UUFFRCxPQUFPLFFBQVEsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDO0lBQ3BELENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFRyYWNrZXIgfSBmcm9tIFwiLi4vdHJhY2tlci90cmFja2VyXCI7XG5pbXBvcnQgeyBTZXRQcm9wZXJ0eUV4cHJlc3Npb24gfSBmcm9tIFwiLi4vcmVmbGVjdG9yL2V4cHJlc3Npb25zXCI7XG5pbXBvcnQgeyBQcm9wZXJ0aWVzVmFsdWVTdG9yYWdlIH0gZnJvbSBcIi4vcHJvcGVydGllcy12YWx1ZS5zdG9yYWdlXCI7XG5pbXBvcnQgeyBJbnRlcmFjdGlvblBsYXllciB9IGZyb20gXCIuLi9pbnRlcmFjdGlvbi1wbGF5ZXJzL2ludGVyYWN0aW9uLnBsYXllclwiO1xuaW1wb3J0IHsgTW9xQVBJIH0gZnJvbSBcIi4uL21vcVwiO1xuaW1wb3J0IHsgUHJvcGVydHlJc1JlYWRPbmx5VGVzdGVyIH0gZnJvbSBcIi4uL2V4cGxvcmVycy9oYXMtcHJvcGVydHkuZXhwbG9yZXIvcHJvcGVydHktaXMtcmVhZC1vbmx5LnRlc3RlclwiO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuZXhwb3J0IGNsYXNzIFNldFRyYXAge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIHRyYWNrZXI6IFRyYWNrZXIsXG4gICAgICAgIHByaXZhdGUgcHJvcGVydGllc1ZhbHVlU3RvcmFnZTogUHJvcGVydGllc1ZhbHVlU3RvcmFnZSxcbiAgICAgICAgcHJpdmF0ZSBpbnRlcmFjdGlvblBsYXllcjogSW50ZXJhY3Rpb25QbGF5ZXIsXG4gICAgICAgIHByaXZhdGUgcHJvcGVydHlJc1JlYWRPbmx5VGVzdGVyOiBQcm9wZXJ0eUlzUmVhZE9ubHlUZXN0ZXIpIHtcblxuICAgIH1cblxuICAgIHB1YmxpYyBpbnRlcmNlcHQodGFyZ2V0OiBhbnksIHByb3BlcnR5OiBQcm9wZXJ0eUtleSwgdmFsdWU6IGFueSk6IGJvb2xlYW4ge1xuICAgICAgICBjb25zdCBleHByZXNzaW9uID0gbmV3IFNldFByb3BlcnR5RXhwcmVzc2lvbihwcm9wZXJ0eSwgdmFsdWUpO1xuXG4gICAgICAgIHRoaXMudHJhY2tlci5hZGQoZXhwcmVzc2lvbik7XG5cbiAgICAgICAgaWYgKHByb3BlcnR5ID09PSBNb3FBUEkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLnByb3BlcnR5SXNSZWFkT25seVRlc3Rlci5pc1JlYWRPbmx5KHByb3BlcnR5KSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWNjZXB0ZWQgPSB0aGlzLmludGVyYWN0aW9uUGxheWVyLnBsYXkoZXhwcmVzc2lvbik7XG4gICAgICAgIGlmIChhY2NlcHRlZCA9PT0gdHJ1ZSB8fCBhY2NlcHRlZCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLnByb3BlcnRpZXNWYWx1ZVN0b3JhZ2Uuc2V0KHByb3BlcnR5LCB2YWx1ZSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWNjZXB0ZWQgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBhY2NlcHRlZDtcbiAgICB9XG59XG4iXX0=